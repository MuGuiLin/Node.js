<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>ç®€æ˜“èŠå¤©å®¤</title>
	<style>
		body{background:linear-gradient(-225deg,#77ffd2,#6297db 48%,#1eecff);}
		h1{color:#fff;text-align:center;}
		.num{margin:auto;width:60%;color:#fff;text-align:right;line-height:40px;}
		.num b{color:#ff0;}
		.box{overflow-y:auto;margin:auto;width:60%;height:520px;border:1px solid #fff;background:#ececec;}
		.btn{position:fixed;bottom:0;left:20%;box-sizing:border-box;margin:auto;padding:10px;width:60%;border:1px solid #fff;background:#2dd8f6;}
		.btn .text{float:left;padding-left:4px;width:68%;height:30px;vertical-align:top;}
		.btn .send{float:right;width:28%;height:36px;vertical-align:top;}
		.list{margin:10px auto;padding:4px;width:90%;border:1px solid #8a00ff;border-radius:3px;color:#000;line-height:30px;}
		.list b{color:#00f;}
		.list i{color:red;font-size:14px;}
		.list p{margin-top:0;padding-left:30px;font-size:18px;line-height:30px;}
		.list p i{color:#ff00af;font-style:normal;}
		@media screen and (max-width:750px){.box{width:90%;}
		.btn{left:0;display:flex;width:100%;}
		.num{width:90%;}
		}
		@keyframes mover{40%{color:#f4f4f4;opacity:1;}
		60%{color:#07a931;}
		80%{color:#ff00b1;}
		}
		.h1-move{margin:20px auto;width:80%;color:#333;text-align:center;text-transform:uppercase;letter-spacing:2px;font-size:42px;}
		.h1-move i:nth-of-type(2){animation-delay:.05s;}
		.h1-move i:nth-of-type(3){animation-delay:.1s;}
		.h1-move i:nth-of-type(4){animation-delay:.15s;}
		.h1-move i:nth-of-type(5){animation-delay:.2s;}
		.h1-move i{text-shadow:0 1px 10px #fff;font-weight:700;font-style:normal;animation:mover 1s ease-in-out infinite;}
	</style>
</head>

<body>
	<h1 class="h1-move"><i>ç®€</i> <i>æ˜“</i> <i>èŠ</i> <i>å¤©</i> <i>å®¤</i></h1>

	<hr>
	<div class="num">æ¬¢è¿ <b><%= user %></b>ï¼ å½“å‰åœ¨çº¿äººæ•°ï¼š<b id="user-num">0</b> ä½</div>
	<section class="box" id="box"></section>

	<hr>
	<div class="btn">
		<input type="text" class="text" id="text" value="" placeholder="è¯·è¾“å…¥èŠå¤©å†…å®¹" /> &nbsp; <input type="button" class="send" id="send" value="å‘ é€" />
	</div>

</body>

<script src="js/jquery.min.js"></script>
<script src="socket.io/socket.io.js"></script>

<script>
	//å¯¹è±¡
	let ws = io();

	//åº•éƒ¨
	let scroll = (o) => {
		o.scrollTop = o.scrollHeight
	};

	//å‘é€
	let send = () => {
		let msg = $('#text').val() || 'æˆ‘æ˜¯æ‰“é…±æ²¹çš„ â˜†';
		ws.emit("chat", {
			"msg": msg,
			"user": '<%= user %>',
			"time": new Date().toLocaleString() 
		});

		$('#text').val('');
	}

	//ç™»å½•
	ws.emit('login', { user: '<%= user %>', time: new Date().toLocaleString() });

	//äººæ•°
	ws.on('usernum', (num) => {
		$('#user-num').text(num);
	});

	//èŠå¤©
	ws.on('chat', (ret) => {
		const avatar = ['ğŸ‘±', 'ğŸ‘©', 'ğŸ‘§', 'ğŸ‘¶', 'ğŸ‘¨', 'ğŸ‘¦', 'ğŸ‘µ', 'ğŸ‘´', 'ğŸ‘®', 'ğŸ‘²', 'ğŸ‘³', 'ğŸ‘·', 'â›‘', 'ğŸ‘¸', 'ğŸ¤´', 'ğŸ’‚', 'ğŸ•µ', 'ğŸ…', 'ğŸ¤¶', 'ğŸ‘¼', 'ğŸ‘°', 'ğŸ¤µ', 'ğŸ™']
		$('#box').append(`<div class="list"><b>${avatar[parseInt(Math.random() * avatar.length + 1)]}ã€${ret.user}ã€‘ï¼š </b>â°<i>${ret.time}</i><br/><p><i>ğŸ“¢ </i>${ret.msg}`);

		scroll(document.querySelector('#box'));
	});

	//å‘é€
	document.querySelector('#send').onclick = () => {
		send();
	};

	//å›è½¦
	document.addEventListener('keyup', (e) => {
		let code = e.charCode || e.keyCode;
		if (13 == code) {
			send();
		}
	}, false);
</script>

</html>